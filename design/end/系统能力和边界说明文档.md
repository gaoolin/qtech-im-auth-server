# 系统能力和资源边界介绍
#### 系统概述

本认证系统主要用于管理用户、角色、权限以及与其他系统的集成认证。它基于 Spring Boot 开发，使用 Oracle 数据库来存储数据，并通过 API 实现对外访问。

此系统是一个认证和授权管理平台，主要为智能制造行业内部的各种应用服务和后台接口提供统一的认证机制和权限控制。该系统具有以下主要功能：

* 用户管理：包括用户注册、登录、权限管理、用户信息查看和修改。

* 角色管理：定义不同的角色，每个角色可以拥有不同的权限。

* 权限管理：控制用户访问特定资源的能力，支持不同的操作类型，如查看、修改、删除等。

* OAuth认证：支持OAuth 2.0认证，为外部系统提供安全认证接口。

* API密钥管理：为系统提供与API集成的能力，可以为用户和外部系统分配API密钥。

* 审计日志：记录用户的行为和系统操作，用于后续审计和监控。

#### 系统边界
* 权限控制：系统仅在内部使用，主要管理不同角色和用户在企业内部系统中的访问权限。

* 认证方式：支持JWT（JSON Web Token）认证、OAuth认证、会话管理。

* 系统整合：可与内部的MES、ERP、WMS等系统集成，支持API认证。

* 数据隐私：用户的个人信息（如工号、部门、角色）需要严格保护，系统未涉及复杂的安全监控和日志审计功能（如监控未登录的非法访问等）。

下面是系统中各个表的详细介绍以及它们的用途和字段说明。
## 1. 用户表（im_auth_user）

### 目的
存储用户的基本信息，用于系统中的身份验证和授权管理。

### 字段说明
| 字段名          | 数据类型     | 描述               |
| --------------- | ------------ | ------------------ |
| `user_id`       | INT          | 用户ID，主键，自动生成 |
| `employee_id`   | VARCHAR(50)   | 工号，唯一标识用户  |
| `username`      | VARCHAR(50)   | 用户名             |
| `password_hash` | VARCHAR(255)  | 加密后的密码       |
| `email`         | VARCHAR(100)  | 用户邮箱           |
| `department`    | VARCHAR(50)   | 部门               |
| `section`       | VARCHAR(50)   | 小组               |
| `gender`        | VARCHAR(10)   | 性别               |
| `status`        | VARCHAR(20)   | 用户状态（例如：ACTIVE、INACTIVE） |

### 使用说明
- 用户表用于存储所有参与认证系统的用户信息。系统会根据用户的工号、用户名或部门等信息进行查询。
- 密码字段采用加密存储，保障用户信息的安全性。
- 用户状态字段用于管理用户是否可以使用系统，常见的值包括 "ACTIVE"（活跃）和 "INACTIVE"（非活跃）。
- `user_id`：用于标识每个用户。
- `employee_id`：唯一标识员工，常用于在外部系统中识别用户。
- `username`：用于系统登录。
- `password_hash`：系统存储的是密码的哈希值，确保密码安全性。
- `email`：用户的电子邮件地址，用于系统通知等。
- `department` 和 section：便于根据部门和岗位来进行权限控制。
- `status`：标识用户的活跃状态，ACTIVE 为启用，INACTIVE 为禁用。

## 2. 角色表（im_auth_role）

### 目的
存储系统中定义的所有角色，这些角色用于权限管理和用户角色分配。

### 字段说明
| 字段名      | 数据类型     | 描述                       |
| ----------- | ------------ | -------------------------- |
| `role_id`   | INT          | 角色ID，主键，自动生成      |
| `role_name` | VARCHAR(50)   | 角色名称                    |
| `description`| VARCHAR(255) | 角色描述                    |

### 使用说明
- 角色表用于定义系统中的所有角色（例如：管理员、工程师、班组长等）。每个角色具有不同的权限集。
- 角色描述字段提供该角色的详细信息，帮助管理员理解各个角色的功能。
- `role_id`：用于标识每个角色。
- `role_name`：定义不同的角色名称，每个角色有不同的权限。
- `description`：对角色的详细描述，便于理解角色的职责和权限范围。

## 3. 用户角色关联表（im_auth_user_role）

### 目的
实现用户和角色的多对多关系，表示一个用户可以拥有多个角色。

### 字段说明
| 字段名      | 数据类型     | 描述                       |
| ----------- | ------------ | -------------------------- |
| `user_role_id` | INT       | 用户角色关联ID，主键       |
| `user_id`   | INT          | 用户ID，外键关联 `im_auth_user` |
| `role_id`   | INT          | 角色ID，外键关联 `im_auth_role` |

### 使用说明
- 用户和角色的关联通过该表进行存储。每个用户可以有多个角色，从而赋予其相应的权限。
- 通过该表，系统能够灵活地管理用户和角色之间的关系。
- 该表实现了用户和角色之间的多对多关联关系。用户可以通过多个角色获得不同的权限。

## 4. 权限表（im_auth_permission）

### 目的
存储系统中定义的所有权限，表示对特定资源的访问控制。

### 字段说明
| 字段名        | 数据类型     | 描述                             |
| ------------- | ------------ | -------------------------------- |
| `permission_id` | INT         | 权限ID，主键，自动生成            |
| `permission_name` | VARCHAR(50) | 权限名称                          |
| `description`  | VARCHAR(255) | 权限描述                          |
| `resource_name`| VARCHAR(50)  | 资源名称（如：USER、REPORT等）     |
| `action_type`  | VARCHAR(20)  | 操作类型（如：READ、WRITE、DELETE） |
| `system_name`  | VARCHAR(50)  | 系统名称                          |
| `application_name`| VARCHAR(50)| 应用名称                          |

### 使用说明
- 权限表用于定义系统中的各类权限，例如查看用户、修改用户等。
- 权限可以应用于不同的资源（如：用户、报表、设备等），并且可以对这些资源执行不同的操作（如：读取、写入、删除）。
- `permission_id`：权限的唯一标识。
- `permission_name`：权限的具体名称，例如查看用户、修改用户等。
- `resource_name`：资源类型，定义权限应用的资源。
- `action_type`：定义具体的操作类型（如：读取、写入、删除等）。
- `system_name`：权限所属的系统。
- `application_name`：权限所属的应用。

## 5. 角色权限关联表（im_auth_role_permission）

### 目的
实现角色和权限之间的多对多关系，表示每个角色拥有的具体权限。

### 字段说明
| 字段名      | 数据类型     | 描述                       |
| ----------- | ------------ | -------------------------- |
| `role_permission_id` | INT  | 角色权限关联ID，主键       |
| `role_id`   | INT          | 角色ID，外键关联 `im_auth_role` |
| `permission_id` | INT     | 权限ID，外键关联 `im_auth_permission` |

### 使用说明
- 通过角色权限表，系统能够灵活地为不同的角色分配不同的权限。
- 这使得权限管理更加细致，能够精确控制每个角色在不同应用中的操作权限。
- 该表实现了角色与权限之间的多对多关联关系。每个角色可以拥有多个权限。

## 6. API Key 表（im_auth_api_key）

### 目的
存储每个用户生成的 API 密钥，用于系统的 API 访问认证。

### 字段说明
| 字段名    | 数据类型   | 描述                      |
| --------- | ---------- | ------------------------- |
| `api_key_id` | INT      | API密钥ID，主键，自动生成 |
| `user_id` | INT        | 用户ID，外键关联 `im_auth_user` |
| `api_key` | VARCHAR(255) | API密钥                    |

### 使用说明
- 每个用户都可以生成一个或多个 API 密钥，用于外部系统访问认证。
- 通过 API 密钥，系统能够验证请求来源，并确保只有授权的用户能够访问接口。
- user_id：关联的用户ID。
- api_key：为用户或外部系统分配的API密钥。

## 7. OAuth 客户端表（im_auth_oauth_client）

### 目的
存储与外部系统集成时所用的 OAuth 客户端信息，用于 OAuth 认证。

### 字段说明
| 字段名        | 数据类型     | 描述                                |
| ------------- | ------------ | ----------------------------------- |
| `client_id`   | VARCHAR(50)   | 客户端ID，唯一标识外部应用或服务    |
| `client_name` | VARCHAR(100)  | 客户端名称                          |
| `system_name` | VARCHAR(50)   | 系统名称                            |
| `client_secret` | VARCHAR(255) | 客户端密钥                          |
| `grant_types` | VARCHAR(50)   | 授权类型（如：client_credentials）  |
| `redirect_uris` | VARCHAR(255) | 重定向URI，OAuth流程中的回调地址   |
| `scopes`      | VARCHAR(100)  | 客户端的访问权限范围（如：read, write）|
| `created_at`  | TIMESTAMP     | 客户端创建时间                      |

### 使用说明
- 该表用于管理外部系统与认证系统的集成，支持 OAuth2 认证。
- 系统根据 OAuth 客户端信息进行验证，确保外部系统安全地访问内部资源。
- client_id：OAuth客户端的唯一标识。
- client_name：外部客户端的名称。
- client_secret：客户端密钥，用于OAuth认证。
- grant_types：OAuth授权类型，定义客户端如何获取授权。
- redirect_uris：授权回调URI，用于客户端处理认证返回。
- scopes：授权范围，定义客户端可以访问的资源范围。

## 8. 会话表（im_auth_session）

### 目的
存储用户的会话信息，用于管理用户的登录状态。

### 字段说明
| 字段名      | 数据类型     | 描述                     |
| ----------- | ------------ | ------------------------ |
| `session_id`| INT          | 会话ID，主键，自动生成    |
| `user_id`   | INT          | 用户ID，外键关联 `im_auth_user` |
| `session_token` | VARCHAR(255) | 会话令牌                 |
| `expires_at` | TIMESTAMP   | 会话过期时间             |

### 使用说明
- 该表存储了每个用户的会话信息，用于验证用户的登录状态和防止重复登录。
- 通过会话表，系统能够跟踪每个用户的会话并在过期后自动失效。
- session_token：存储会话令牌，用于验证当前用户会话的有效性。
- expires_at：会话过期时间，表示会话的有效期限。

## 9. 审计日志表（im_auth_audit_log）

### 目的
记录用户操作的审计日志，用于安全审计和追踪操作历史。

### 字段说明
| 字段名    | 数据类型   | 描述                            |
| --------- | ---------- | ------------------------------- |
| `log_id`  | INT        | 日志ID，主键，自动生成          |
| `user_id` | INT        | 用户ID，外键关联 `im_auth_user` |
| `action`  | VARCHAR(255) | 用户执行的操作                  |
| `ip_address` | VARCHAR(50) | 用户操作时的IP地址              |

### 使用说明
- 每当用户执行关键操作时，都会在审计日志表中记录一条日志，确保每次操作都可以追溯。
- 日志表记录的信息包括操作类型、操作人和操作时间等。
- action：记录用户的操作行为。
- ip_address：记录用户操作时的IP地址。

## 总结

本认证系统通过用户、角色、权限的管理实现了灵活的权限控制，同时还支持与外部系统集成，如 OAuth2 和 API 密钥管理。通过这些功能，系统能够有效地管理各类用户和资源的访问权限，并为外部应用提供安全认证接口。
